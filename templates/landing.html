<!doctype html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
	<title>Telefon</title>
	<script src="/scripts/htmx@2.0.2.js"></script>
	<script src="/scripts/htmx@2.0.2_response_targets.js"></script>
	<link rel="stylesheet" href="/style.css">
	<script src="/scripts/hyperscript.org@0.9.12.js"></script>
</head>

<body hx-ext="response-targets" class="min-h-screen bg-neutral-700 text-sky-500 font-mono">
	<div class="flex justify-center bg-neutral-900 border-zinc-400 border-b-4 w-full mb-20">
		<div class="flex justify-between w-4/5">
		<div class="text-xl"> $whoami &rarr; <b>{{ username }}</b> </div>
		<a class="text-xl hover:text-sky-300" href="/logout">Logout</a>
		</div>
	</div>

	<div class="flex justify-center m-14">
		<div class="text-xl text-red-500" id="error_display" _="on htmx:beforeSend from elsewhere set my innerHTML to ''"></div>
	</div>

	<div class="flex justify-center m-14">
		<button
			class="text-xl text-sky-500 bg-lime-700/70 p-2 rounded-lg hover:rounded-2xl hover:bg-lime-700"
			hx-get="/web/call-forward/new"
			hx-target="#phantom_row"
			hx-swap="afterend">
			New call-forward
		</button>
	</div>

	<div id="flex justify-center text-inherit">
		<div id="existing-forwards" class="flex justify-center bg-neutral-700 text-sky-300">
			<div class="flex flex-col justify-evenly w-4/5">
				<div class="tr flex justify-evenly w-full p-2 border-zinc-400 border-2">
					<div class="td w-40 flex justify-center">From</div>
					<div class="td w-40 flex justify-center">To</div>
					{% for ctx in contexts %}
						<div class="td w-20 flex justify-center">{{ ctx.display_name }}</div>
					{% endfor %}
					<div class="w-44"></div>
				</div>

				<div class="tr" id="phantom_row"></div>

				{% for fwd in existing_forwards %}
					<div class="tr flex justify-evenly w-full p-2 border-zinc-400 border-2">
						<div class="td w-40 text-neutral-200 font-mono border-2 flex flex-col justify-center">
							<div class="flex justify-center text-balance">{{ fwd.from }}</div>
						</div>
						<div class="td w-40 text-neutral-200 font-mono border-2 flex flex-col justify-center">
							<div class="flex justify-center text-balance">{{ fwd.to }}</div>
						</div>
						{% for ctx in contexts %}
							<div class="w-20 flex justify-center">
								{% if fwd.in_contexts.contains(ctx) %}
								<div class="w-7 h-7 border-zinc-400 bg-sky-400"></div>
								{% else %}
								<div class="w-7 h-7"></div>
								{% endif %}
							</div>
						{% endfor %}
						<div class="td w-44 flex justify-center">
						<button
							hx-get="/web/call-forward/{{ fwd.fwd_id }}/edit"
							hx-target="closest div.tr"
							hx-swap="outerHTML"
							hx-indicator="#indicator-from-show"
							class="h-14 w-16 bg-neutral-800 hover:bg-neutral-600 rounded-lg hover:rounded-2xl">
							Edit
						</button>
						<button
							hx-delete="/web/call-forward/{{ fwd.fwd_id }}"
							hx-target="closest div.tr"
							hx-swap="outerHTML"
							hx-indicator="#indicator-from-show"
							class="h-14 w-16 bg-red-600/70 hover:bg-red-600/90 rounded-lg hover:rounded-2xl">
							Delete
						</button>
							<div
								class="htmx-indicator inline-block h-8 w-8 animate-spin rounded-full border-4 border-solid border-e-transparent
									align-[-0.125em]
									text-surface
									motion-reduce:animate-[spin_1.5s_linear_infinite]"
								id="indicator-from-show">
							<span
								class="!absolute !-m-px !h-px !w-px !overflow-hidden !whitespace-nowrap !border-0 !p-0 ![clip:rect(0,0,0,0)]"
								>Loading...</span>
							</div>
						</div>
					</div>
				{% endfor %}
			</div>
		</div>
	</div>
</body>

</html>
